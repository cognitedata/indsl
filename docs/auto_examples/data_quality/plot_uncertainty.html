

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Relative uncertainty estimation &mdash; indsl 8.8.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=d2d258e8" />
      <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
      <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />

  
    <link rel="shortcut icon" href="../../_static/cognite_logo_black.png"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=ce2bb500"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            indsl
              <img src="../../_static/cognite_logo_white.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Toolboxes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../data_quality.html">Data Quality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../detect.html">Detect</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../drilling.html">Drilling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../equipment.html">Equipment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filter.html">Filter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fluid_dynamics.html">Fluid Dynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../forecast.html">Forecast</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../numerical_calculus.html">Numerical Calculus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../oil_and_gas.html">Oil and Gas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../resample.html">Resample</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../signals.html">Signals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../smooth.html">Smooth</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../statistics.html">Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sustainability.html">Sustainability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ts_utils.html">Basic time series functions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">Data quality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../detect/index.html">Detection Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../equipment/index.html">Equipment Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filter/index.html">Filter Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fluid_dynamics/index.html">Fluid Dynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../forecast/index.html">Forecasting Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../numerical_calculus/index.html">Numerical Calculus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../oil_and_gas/index.html">Oil and Gas Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resample/index.html">Resampling Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../signals/index.html">Synthetic Signal Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../smooth/index.html">Smoothing Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../statistics/index.html">Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sustainability/index.html">Sustainability Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ts_utils/index.html">Rolling standard deviation and variance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../versioning/index.html">Function versioning</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contribute.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../code_of_conduct.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev_tools.html">Developer utility functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CHANGELOG.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">indsl</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Relative uncertainty estimation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/auto_examples/data_quality/plot_uncertainty.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-examples-data-quality-plot-uncertainty-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="relative-uncertainty-estimation">
<span id="sphx-glr-auto-examples-data-quality-plot-uncertainty-py"></span><h1>Relative uncertainty estimation<a class="headerlink" href="#relative-uncertainty-estimation" title="Link to this heading">ÔÉÅ</a></h1>
<p>This example shows how to estimate the relative uncertainty of a non-linear, non-stationary signal using detrending.
We generate a synthetic signal composed of:</p>
<blockquote>
<div><ul class="simple">
<li><p>Three oscillatory signals of different but significant amplitudes</p></li>
<li><p>Two polynomial functions or trends</p></li>
<li><p>Data drift</p></li>
</ul>
</div></blockquote>
<p>To make the case more realistic, from an industrial perspective, the timestamps are modified to make them nonuniform
and 35% of the data points are randomly removed. Finally, Gaussian noise with a signal-to-noise ratio of 10db and 20db is
are added to the left and right half of the data, respectively.</p>
<p>The figure shows the synthetic signal with and without noise (top), and the estimated relative uncertainty (bottom).
On the left half of the data, where the noise is large, the estimated relative uncertainty increases when the signal
reaches close to 100%. On the right side half of the data, where the noise is small, the relative uncertainty remains closer to 0%.</p>
<img src="../../_images/sphx_glr_plot_uncertainty_001.png" srcset="../../_images/sphx_glr_plot_uncertainty_001.png" alt="Signal, Relative uncertainty" class = "sphx-glr-single-img"/><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">indsl.data_quality</span><span class="w"> </span><span class="kn">import</span> <span class="n">uncertainty_rstd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">indsl.signals</span><span class="w"> </span><span class="kn">import</span> <span class="n">insert_data_gaps</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">perturb_timestamp</span><span class="p">,</span> <span class="n">sine_wave</span><span class="p">,</span> <span class="n">white_noise</span>


<span class="n">seed</span> <span class="o">=</span> <span class="mi">21</span>

<span class="n">start_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">&quot;2022-02-28&quot;</span><span class="p">)</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">&quot;2022-03-02&quot;</span><span class="p">)</span>

<span class="c1"># Wave 1: Small amplitude, long wave period</span>
<span class="n">wave01</span> <span class="o">=</span> <span class="n">sine_wave</span><span class="p">(</span>
    <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
    <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
    <span class="n">sample_freq</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s2">&quot;1m&quot;</span><span class="p">),</span>
    <span class="n">wave_period</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s2">&quot;6h&quot;</span><span class="p">),</span>
    <span class="n">wave_mean</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">wave_amplitude</span><span class="o">=</span><span class="mf">6.5</span><span class="p">,</span>
    <span class="n">wave_phase</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">wave01</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">wave01</span><span class="p">)</span>

<span class="c1"># Wave 2: Large amplitude, short wave period</span>
<span class="n">wave02</span> <span class="o">=</span> <span class="n">sine_wave</span><span class="p">(</span>
    <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
    <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
    <span class="n">sample_freq</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s2">&quot;1m&quot;</span><span class="p">),</span>
    <span class="n">wave_period</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s2">&quot;1h&quot;</span><span class="p">),</span>
    <span class="n">wave_mean</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">wave_amplitude</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">wave_phase</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Wave 3: Large amplitude, short wave period</span>
<span class="n">wave03</span> <span class="o">=</span> <span class="n">sine_wave</span><span class="p">(</span>
    <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
    <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
    <span class="n">sample_freq</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s2">&quot;1m&quot;</span><span class="p">),</span>
    <span class="n">wave_period</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s2">&quot;3h&quot;</span><span class="p">),</span>
    <span class="n">wave_mean</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">wave_amplitude</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span>
    <span class="n">wave_phase</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Trends</span>
<span class="n">trend_01</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">line</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span> <span class="n">sample_freq</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s2">&quot;1m&quot;</span><span class="p">),</span> <span class="n">slope</span><span class="o">=</span><span class="mf">0.00008</span><span class="p">,</span> <span class="n">intercept</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span>
<span class="p">)</span>

<span class="n">trend_02</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">line</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span> <span class="n">sample_freq</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s2">&quot;1m&quot;</span><span class="p">),</span> <span class="n">slope</span><span class="o">=-</span><span class="mf">0.00005</span><span class="p">,</span> <span class="n">intercept</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="o">**</span> <span class="mi">5</span>
<span class="p">)</span>

<span class="n">drift</span> <span class="o">=</span> <span class="n">line</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span> <span class="n">sample_freq</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s2">&quot;1m&quot;</span><span class="p">),</span> <span class="n">slope</span><span class="o">=</span><span class="mf">0.00005</span><span class="p">,</span> <span class="n">intercept</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">signal</span> <span class="o">=</span> <span class="n">wave01</span> <span class="o">+</span> <span class="n">wave02</span> <span class="o">+</span> <span class="n">wave03</span> <span class="o">+</span> <span class="n">trend_01</span> <span class="o">+</span> <span class="n">trend_02</span> <span class="o">-</span> <span class="n">drift</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">signal</span><span class="p">)</span>
<span class="n">signal_w_noise_high_db</span> <span class="o">=</span> <span class="n">perturb_timestamp</span><span class="p">(</span><span class="n">white_noise</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">snr_db</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">))</span>
<span class="n">signal_w_noise_low_db</span> <span class="o">=</span> <span class="n">perturb_timestamp</span><span class="p">(</span><span class="n">white_noise</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">snr_db</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">))</span>
<span class="n">signal_w_noise</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">signal_w_noise_low_db</span><span class="p">[:</span> <span class="n">N</span> <span class="o">//</span> <span class="mi">2</span><span class="p">],</span> <span class="n">signal_w_noise_high_db</span><span class="p">[</span><span class="n">N</span> <span class="o">//</span> <span class="mi">2</span> <span class="p">:]])</span>

<span class="n">signal_to_analyse</span> <span class="o">=</span> <span class="n">insert_data_gaps</span><span class="p">(</span><span class="n">signal_w_noise</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;Random&quot;</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.35</span><span class="p">)</span>

<span class="n">uncertainty</span> <span class="o">=</span> <span class="n">uncertainty_rstd</span><span class="p">(</span><span class="n">signal_to_analyse</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">signal_to_analyse</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Signal with noise and perturbation&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Synthetic signal&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Signal&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Amplitude&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">uncertainty</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Estimated relative uncertainty&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Relative uncertainty&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Percentage&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  3.386 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-data-quality-plot-uncertainty-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/a2d9d3055911d592949dce5739ff289f/plot_uncertainty.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_uncertainty.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/8e2b9a4518b58bbb6308321a8f535d34/plot_uncertainty.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_uncertainty.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Cognite AS &lt;support@cognite.com&gt;.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>